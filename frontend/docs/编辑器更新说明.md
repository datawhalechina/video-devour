# 📝 编辑器功能更新说明

## ✨ 最新更新

### 1. 🎨 顶部工具栏（可折叠）

在编辑器顶部新增了一个功能强大的工具栏，支持一键格式化：

#### 功能分组

- **文本格式**：粗体、斜体、下划线、删除线、行内代码、链接
- **标题**：一级标题、二级标题、三级标题
- **列表**：无序列表、有序列表、引用
- **对齐**：左对齐、居中、右对齐

#### 特性

- ✅ **一键折叠/展开**：点击右上角按钮折叠工具栏，节省空间
- ✅ **实时状态**：当前格式会高亮显示（蓝色背景）
- ✅ **悬停提示**：每个按钮都有工具提示
- ✅ **固定顶部**：滚动时工具栏始终可见（sticky positioning）
- ✅ **流畅动画**：折叠展开带有平滑过渡效果

### 2. 🖼️ 图片查看器优化

大幅提升图片查看器的拖动和缩放体验：

#### 性能优化

- ✅ **requestAnimationFrame**：使用浏览器动画帧优化拖动和缩放
- ✅ **GPU 加速**：使用 `will-change: transform` 启用硬件加速
- ✅ **丝滑拖动**：拖动时取消过渡动画，停止时恢复
- ✅ **流畅缩放**：滚轮缩放速度优化（0.15 增量）
- ✅ **防止抖动**：使用 RAF 节流，避免过度渲染

#### 体验改进

- ✅ **选择禁用**：图片添加 `select-none` 类，避免拖动时误选文本
- ✅ **光标变化**：拖动时显示 `grabbing`，静止时显示 `grab`
- ✅ **防止默认**：阻止图片的默认拖动行为
- ✅ **智能过渡**：只在非拖动状态下使用过渡动画

## 🎯 使用方法

### 工具栏使用

1. **打开编辑器**，工具栏自动显示在顶部
2. **选中文本**，点击工具栏按钮应用格式
3. **折叠工具栏**：点击右上角的箭头图标
4. **快捷键**：继续支持 Ctrl+B（粗体）、Ctrl+I（斜体）等

### 图片查看器使用

1. **插入图片**：输入 `/image`，粘贴图片 URL
2. **点击图片**：打开全屏查看器
3. **拖动图片**：按住鼠标左键拖动（非常流畅！）
4. **滚轮缩放**：向上滚动放大，向下滚动缩小
5. **重置视图**：点击顶部工具栏的"重置"按钮
6. **关闭查看器**：按 ESC 或点击背景

## 🔧 技术实现

### 顶部工具栏

- **组件位置**：`src/components/Editor/Toolbars/FloatingToolbar.jsx`
- **集成方式**：在 `DocumentEditor.jsx` 中引入
- **状态管理**：使用 Slate 的 `useSlate` hook 获取编辑器实例
- **格式切换**：通过 `Editor.addMark/removeMark` 和 `Transforms.setNodes`

### 图片查看器优化

- **性能优化**：使用 `requestAnimationFrame` 避免频繁重绘
- **硬件加速**：CSS `will-change` 属性提示浏览器优化
- **事件节流**：RAF 自动实现节流，避免性能问题
- **平滑过渡**：条件性应用 CSS transition

## 📊 性能对比

### 优化前

- ❌ 拖动时可能出现卡顿
- ❌ 缩放不够流畅
- ❌ 频繁的状态更新导致重绘

### 优化后

- ✅ 拖动丝滑流畅（60fps）
- ✅ 缩放响应迅速
- ✅ RAF 节流优化性能
- ✅ GPU 加速减少 CPU 负担

## 🚀 快速体验

```bash
# 启动开发服务器
npm run dev

# 访问编辑器
http://localhost:3001
```

### 测试图片 URL

```
https://picsum.photos/1920/1080
https://images.unsplash.com/photo-1506905925346-21bda4d32df4
```

## 📝 更新文件

1. **FloatingToolbar.jsx** - 新增可折叠顶部工具栏
2. **DocumentEditor.jsx** - 集成顶部工具栏
3. **ImageBlock.jsx** - 优化图片查看器性能
4. **SlashMenu.jsx** - 用户已优化自动滚动功能

---

享受全新的编辑体验！ 🎉
