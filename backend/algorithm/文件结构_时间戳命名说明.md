# æ–‡ä»¶ç»“æ„ - æ—¶é—´æˆ³å‘½åè¯´æ˜

## ğŸ“‹ æ¦‚è¿°

é¡¹ç›®ä¸­æ‰€æœ‰è¾“å‡ºæ–‡ä»¶å’Œç›®å½•éƒ½é‡‡ç”¨ç»Ÿä¸€çš„æ—¶é—´æˆ³å‘½åæ–¹æ¡ˆï¼Œç¡®ä¿æ¯æ¬¡è¿è¡Œçš„ç»“æœéƒ½å¯è¿½æº¯ã€ä¸ä¼šç›¸äº’è¦†ç›–ã€‚

## ğŸ• æ—¶é—´æˆ³æ ¼å¼

**ç»Ÿä¸€æ ¼å¼**ï¼š`YYYYMMDD_HHMMSS`

- **ç¤ºä¾‹**ï¼š`20251006_103000`ï¼ˆ2025å¹´10æœˆ6æ—¥ 10:30:00ï¼‰
- **ç‰¹ç‚¹**ï¼š
  - æ˜“äºé˜…è¯»
  - æ–‡ä»¶ç³»ç»Ÿå‹å¥½ï¼ˆæ— ç‰¹æ®Šå­—ç¬¦ï¼‰
  - å¯æ’åºï¼ˆå­—æ¯é¡ºåºå³æ—¶é—´é¡ºåºï¼‰
  - å”¯ä¸€æ€§ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰

## ğŸ“ å®Œæ•´æ–‡ä»¶ç»“æ„

### å•æ¬¡è¿è¡Œçš„è¾“å‡ºç»“æ„

å‡è®¾æ—¶é—´æˆ³ä¸º `20251006_103000`ï¼š

```
output/
â”œâ”€â”€ outline_20251006_103000.md                          # åˆå§‹å¤§çº²
â”œâ”€â”€ detailed_outline_20251006_103000.md                 # è¯¦ç»†å¤§çº²ï¼ˆå«åŒ¹é…æ–‡æœ¬ï¼‰
â”‚
â”œâ”€â”€ videocut_20251006_103000/                           # è§†é¢‘åˆ‡ç‰‡ç›®å½•
â”‚   â”œâ”€â”€ 01_é¡¹ç›®æ¶æ„å›¾.mp4
â”‚   â”œâ”€â”€ 02_å¾®è°ƒæ¨¡å—ä¸Promptä¼˜åŒ–æ¨¡å—.mp4
â”‚   â”œâ”€â”€ 03_çŸ¥è¯†åº“é—®ç­”æµç¨‹.mp4
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ frames_01_é¡¹ç›®æ¶æ„å›¾_20251006_103000/              # å¸§æå–ç›®å½•ï¼ˆè§†é¢‘1ï¼‰
â”‚   â”œâ”€â”€ frame_0001.jpg
â”‚   â”œâ”€â”€ frame_0002.jpg
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ frames_02_å¾®è°ƒæ¨¡å—ä¸Promptä¼˜åŒ–æ¨¡å—_20251006_103000/ # å¸§æå–ç›®å½•ï¼ˆè§†é¢‘2ï¼‰
â”‚   â”œâ”€â”€ frame_0001.jpg
â”‚   â”œâ”€â”€ frame_0002.jpg
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ frames_03_çŸ¥è¯†åº“é—®ç­”æµç¨‹_20251006_103000/          # å¸§æå–ç›®å½•ï¼ˆè§†é¢‘3ï¼‰
    â”œâ”€â”€ frame_0001.jpg
    â”œâ”€â”€ frame_0002.jpg
    â””â”€â”€ ...
```

## ğŸ“Š æ–‡ä»¶å‘½åè§„åˆ™

### 1. å¤§çº²æ–‡ä»¶

| æ–‡ä»¶ç±»å‹ | å‘½åæ ¼å¼ | ç¤ºä¾‹ |
|---------|---------|------|
| åˆå§‹å¤§çº² | `outline_æ—¶é—´æˆ³.md` | `outline_20251006_103000.md` |
| è¯¦ç»†å¤§çº² | `detailed_outline_æ—¶é—´æˆ³.md` | `detailed_outline_20251006_103000.md` |

**ç‰¹ç‚¹**ï¼š
- âœ… å¤§çº²æ–‡ä»¶ä½äº `output/` æ ¹ç›®å½•
- âœ… åŒä¸€æ¬¡è¿è¡Œçš„ä¸¤ä¸ªå¤§çº²æ–‡ä»¶å…±äº«ç›¸åŒçš„æ—¶é—´æˆ³
- âœ… ä¾¿äºè¿½è¸ªå¤§çº²çš„ç”Ÿæˆæ—¶é—´

### 2. è§†é¢‘åˆ‡ç‰‡ç›®å½•

| ç±»å‹ | å‘½åæ ¼å¼ | ç¤ºä¾‹ |
|------|---------|------|
| ç›®å½• | `videocut_æ—¶é—´æˆ³/` | `videocut_20251006_103000/` |
| è§†é¢‘æ–‡ä»¶ | `åºå·_æ ‡é¢˜.mp4` | `01_é¡¹ç›®æ¶æ„å›¾.mp4` |

**ç‰¹ç‚¹**ï¼š
- âœ… æ‰€æœ‰è§†é¢‘åˆ‡ç‰‡ä¿å­˜åœ¨å¸¦æ—¶é—´æˆ³çš„æ¯æ–‡ä»¶å¤¹ä¸‹
- âœ… è§†é¢‘æ–‡ä»¶ååŒ…å«åºå·å’Œæ ‡é¢˜
- âœ… æ ‡é¢˜ä¸­çš„ç‰¹æ®Šå­—ç¬¦å·²è¢«æ¸…ç†

### 3. å¸§æå–ç›®å½•

| ç±»å‹ | å‘½åæ ¼å¼ | ç¤ºä¾‹ |
|------|---------|------|
| ç›®å½• | `frames_è§†é¢‘å_æ—¶é—´æˆ³/` | `frames_01_é¡¹ç›®æ¶æ„å›¾_20251006_103000/` |
| å›¾ç‰‡æ–‡ä»¶ | `frame_åºå·.jpg` | `frame_0001.jpg` |

**ç‰¹ç‚¹**ï¼š
- âœ… æ¯ä¸ªè§†é¢‘çš„å¸§æ–‡ä»¶ç‹¬ç«‹å­˜å‚¨
- âœ… ç›®å½•ååŒ…å«åŸè§†é¢‘åå’Œæ—¶é—´æˆ³
- âœ… å¸§æ–‡ä»¶é‡‡ç”¨4ä½æ•°å­—ç¼–å·ï¼ˆ0001-9999ï¼‰

## ğŸ”„ æ—¶é—´æˆ³çš„ä¼ é€’å’Œä¸€è‡´æ€§

### å·¥ä½œæµç¨‹

```
1. main.py ç”Ÿæˆæ—¶é—´æˆ³
   â†“
2. save_outline() ä½¿ç”¨æ—¶é—´æˆ³ä¿å­˜å¤§çº²
   â†“ (è¿”å› outline_path)
3. ä» outline_path æå–æ—¶é—´æˆ³
   â†“
4. generate_detailed_outline() ä½¿ç”¨ç›¸åŒæ—¶é—´æˆ³
   â†“
5. cut_videos_by_headings() ä½¿ç”¨ç›¸åŒæ—¶é—´æˆ³
   â†“ (è¿”å› videocut_path)
6. extract_frames_from_videos() ä½¿ç”¨ç›¸åŒæ—¶é—´æˆ³
```

### ä»£ç å®ç°

```python
# main.py ä¸­çš„å®ç°
def main():
    # ä¿å­˜å¤§çº²å¹¶è·å–è·¯å¾„
    outline_path = outline_handler.save_outline(outline)
    
    # ä»è·¯å¾„ä¸­æå–æ—¶é—´æˆ³ï¼ˆä¿æŒä¸€è‡´æ€§ï¼‰
    outline_timestamp = os.path.basename(outline_path).replace('outline_', '').replace('.md', '')
    
    # åç»­æ­¥éª¤éƒ½ä½¿ç”¨ç›¸åŒçš„æ—¶é—´æˆ³
    outline_handler.generate_detailed_outline(..., timestamp=outline_timestamp)
    videocut_path = video_handler.cut_videos_by_headings(..., timestamp=outline_timestamp)
    video_handler.extract_frames_from_videos(..., timestamp=outline_timestamp)
```

## ğŸ¯ è®¾è®¡ä¼˜åŠ¿

### 1. **å¯è¿½æº¯æ€§**
- âœ… æ¯æ¬¡è¿è¡Œéƒ½æœ‰å”¯ä¸€çš„æ—¶é—´æ ‡è¯†
- âœ… å¯ä»¥è½»æ¾æ‰¾åˆ°æŸä¸ªæ—¶é—´ç‚¹çš„æ‰€æœ‰è¾“å‡º
- âœ… ä¾¿äºé—®é¢˜æ’æŸ¥å’Œç»“æœå¯¹æ¯”

### 2. **é¿å…è¦†ç›–**
- âœ… å¤šæ¬¡è¿è¡Œä¸ä¼šç›¸äº’è¦†ç›–
- âœ… å¯ä»¥ä¿ç•™å†å²è¿è¡Œè®°å½•
- âœ… ä¾¿äºå¯¹æ¯”ä¸åŒå‚æ•°çš„æ•ˆæœ

### 3. **æ–‡ä»¶å…³è”**
- âœ… ç›¸åŒæ—¶é—´æˆ³çš„æ–‡ä»¶å±äºåŒä¸€æ¬¡è¿è¡Œ
- âœ… ä¾¿äºæ‰¹é‡ç®¡ç†å’Œæ¸…ç†
- âœ… æ–‡ä»¶åè‡ªåŒ…å«å®Œæ•´ä¿¡æ¯

### 4. **æ˜“äºæŸ¥æ‰¾**
- âœ… æŒ‰æ—¶é—´æˆ³æ’åºå³æŒ‰è¿è¡Œæ—¶é—´æ’åº
- âœ… æœ€æ–°çš„ç»“æœæ€»æ˜¯åœ¨æœ€å
- âœ… æ”¯æŒé€šé…ç¬¦å¿«é€ŸæŸ¥æ‰¾

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### æŸ¥æ‰¾æœ€æ–°çš„å¤§çº²æ–‡ä»¶

```bash
# Windows PowerShell
Get-ChildItem output\outline_*.md | Sort-Object Name -Descending | Select-Object -First 1

# Linux/Mac
ls -t output/outline_*.md | head -1
```

### Python è„šæœ¬æŸ¥æ‰¾æœ€æ–°ç»“æœ

```python
import glob
from pathlib import Path

def find_latest_results(output_dir="output"):
    """æŸ¥æ‰¾æœ€æ–°ä¸€æ¬¡è¿è¡Œçš„æ‰€æœ‰è¾“å‡º"""
    output_path = Path(output_dir)
    
    # æŸ¥æ‰¾æœ€æ–°çš„å¤§çº²æ–‡ä»¶
    outline_files = sorted(output_path.glob("outline_*.md"))
    if not outline_files:
        return None
    
    latest_outline = outline_files[-1]
    
    # ä»æ–‡ä»¶åæå–æ—¶é—´æˆ³
    timestamp = latest_outline.name.replace('outline_', '').replace('.md', '')
    
    # æ„å»ºç›¸å…³æ–‡ä»¶å’Œç›®å½•çš„è·¯å¾„
    results = {
        'timestamp': timestamp,
        'outline': str(latest_outline),
        'detailed_outline': str(output_path / f"detailed_outline_{timestamp}.md"),
        'videocut_dir': str(output_path / f"videocut_{timestamp}"),
        'frames_dirs': list(output_path.glob(f"frames_*_{timestamp}"))
    }
    
    return results

# ä½¿ç”¨ç¤ºä¾‹
latest = find_latest_results()
if latest:
    print(f"æœ€æ–°è¿è¡Œæ—¶é—´æˆ³: {latest['timestamp']}")
    print(f"å¤§çº²æ–‡ä»¶: {latest['outline']}")
    print(f"è§†é¢‘åˆ‡ç‰‡ç›®å½•: {latest['videocut_dir']}")
    print(f"å¸§ç›®å½•æ•°é‡: {len(latest['frames_dirs'])}")
```

### æ¸…ç†æ—§æ–‡ä»¶

```python
from pathlib import Path
from datetime import datetime, timedelta
import shutil

def cleanup_old_results(days=7, output_dir="output"):
    """
    åˆ é™¤è¶…è¿‡æŒ‡å®šå¤©æ•°çš„è¾“å‡ºæ–‡ä»¶
    
    Args:
        days: ä¿ç•™æœ€è¿‘å¤šå°‘å¤©çš„æ•°æ®
        output_dir: è¾“å‡ºç›®å½•è·¯å¾„
    """
    output_path = Path(output_dir)
    cutoff_date = datetime.now() - timedelta(days=days)
    
    # æ¸…ç†å¤§çº²æ–‡ä»¶
    for outline_file in output_path.glob("outline_*.md"):
        timestamp_str = outline_file.name.replace('outline_', '').replace('.md', '')
        try:
            file_date = datetime.strptime(timestamp_str, "%Y%m%d_%H%M%S")
            if file_date < cutoff_date:
                print(f"åˆ é™¤æ—§å¤§çº²: {outline_file}")
                outline_file.unlink()
        except ValueError:
            pass
    
    # æ¸…ç†è¯¦ç»†å¤§çº²æ–‡ä»¶
    for outline_file in output_path.glob("detailed_outline_*.md"):
        timestamp_str = outline_file.name.replace('detailed_outline_', '').replace('.md', '')
        try:
            file_date = datetime.strptime(timestamp_str, "%Y%m%d_%H%M%S")
            if file_date < cutoff_date:
                print(f"åˆ é™¤æ—§è¯¦ç»†å¤§çº²: {outline_file}")
                outline_file.unlink()
        except ValueError:
            pass
    
    # æ¸…ç†è§†é¢‘åˆ‡ç‰‡ç›®å½•
    for videocut_dir in output_path.glob("videocut_*"):
        if videocut_dir.is_dir():
            timestamp_str = videocut_dir.name.replace('videocut_', '')
            try:
                dir_date = datetime.strptime(timestamp_str, "%Y%m%d_%H%M%S")
                if dir_date < cutoff_date:
                    print(f"åˆ é™¤æ—§è§†é¢‘ç›®å½•: {videocut_dir}")
                    shutil.rmtree(videocut_dir)
            except ValueError:
                pass
    
    # æ¸…ç†å¸§ç›®å½•
    for frames_dir in output_path.glob("frames_*"):
        if frames_dir.is_dir():
            # ä»ç›®å½•åæå–æ—¶é—´æˆ³ï¼ˆæœ€åä¸€ä¸ªä¸‹åˆ’çº¿åçš„éƒ¨åˆ†ï¼‰
            parts = frames_dir.name.split('_')
            if len(parts) >= 2:
                timestamp_str = f"{parts[-2]}_{parts[-1]}"
                try:
                    dir_date = datetime.strptime(timestamp_str, "%Y%m%d_%H%M%S")
                    if dir_date < cutoff_date:
                        print(f"åˆ é™¤æ—§å¸§ç›®å½•: {frames_dir}")
                        shutil.rmtree(frames_dir)
                except ValueError:
                    pass

# ä½¿ç”¨ç¤ºä¾‹
cleanup_old_results(days=7)  # åªä¿ç•™æœ€è¿‘7å¤©çš„æ•°æ®
```

## ğŸ“ æ—¥å¿—è¾“å‡ºç¤ºä¾‹

è¿è¡Œ `main.py` æ—¶çš„æ—¥å¿—è¾“å‡ºï¼š

```
============================================================
å¼€å§‹å¤„ç†æµç¨‹ - æ—¶é—´æˆ³: 20251006_103000
============================================================
--- æ­¥éª¤ 1: å¼€å§‹å¤„ç†ASRæ•°æ® ---
æ£€æµ‹åˆ°æ–°æ ¼å¼ï¼ˆParaformer V2ï¼‰ï¼Œå…± 89 ä¸ªå¥å­
--- ASRæ•°æ®å¤„ç†å®Œæˆ ---

--- æ­¥éª¤ 2: å¼€å§‹ç”ŸæˆLLMå¤§çº² ---
--- LLMå¤§çº²ç”Ÿæˆå®Œæˆ ---

--- æ­¥éª¤ 3: æ­£åœ¨å°†å¤§çº²ä¿å­˜åˆ° output/outline_20251006_103000.md ---
--- å¤§çº²ä¿å­˜æˆåŠŸ ---

--- æ­¥éª¤ 4: æ­£åœ¨å°†æ–‡æœ¬å—ä¸å¤§çº²æ ‡é¢˜è¿›è¡ŒåŒ¹é… ---
...

--- æ­¥éª¤ 5: æ­£åœ¨ç”Ÿæˆè¯¦ç»†å¤§çº²æ–‡ä»¶åˆ° output/detailed_outline_20251006_103000.md ---
--- è¯¦ç»†å¤§çº²ç”ŸæˆæˆåŠŸ ---

--- æ­¥éª¤ 6: å¼€å§‹æ ¹æ®å¤§çº²åˆ‡åˆ†è§†é¢‘ ---
è§†é¢‘ç‰‡æ®µå°†ä¿å­˜åˆ°: output/videocut_20251006_103000
--- è§†é¢‘åˆ‡åˆ†å®Œæˆï¼Œå…±ç”Ÿæˆ 3 ä¸ªè§†é¢‘ç‰‡æ®µ ---

--- æ­¥éª¤ 7: å¼€å§‹ä»è§†é¢‘ç‰‡æ®µä¸­æå–å¸§ ---
ä»ç›®å½•è¯»å–è§†é¢‘æ–‡ä»¶: output/videocut_20251006_103000
æ‰¾åˆ° 3 ä¸ªè§†é¢‘æ–‡ä»¶
æ­£åœ¨ä» '01_é¡¹ç›®æ¶æ„å›¾.mp4' æå–å¸§åˆ° 'output/frames_01_é¡¹ç›®æ¶æ„å›¾_20251006_103000'...
æˆåŠŸä» '01_é¡¹ç›®æ¶æ„å›¾.mp4' æå–äº† 120 å¸§ã€‚
--- å¸§æå–å®Œæˆï¼Œæ€»å…±æå–äº† 350 å¸§ ---

============================================================
å¤„ç†æµç¨‹å®Œæˆ - æ—¶é—´æˆ³: 20251006_103000
============================================================
```

## ğŸ”§ é…ç½®æ–‡ä»¶

åœ¨ `config.py` ä¸­çš„ç›¸å…³é…ç½®ï¼š

```python
# è¿™äº›è·¯å¾„ä»…ç”¨ä½œå‚è€ƒï¼Œå®é™…è¾“å‡ºä¼šæ·»åŠ æ—¶é—´æˆ³
OUTPUT_DIR = os.path.join(PROJECT_ROOT, 'output')
OUTLINE_MD_PATH = os.path.join(OUTPUT_DIR, 'outline.md')
DETAILED_OUTLINE_MD_PATH = os.path.join(OUTPUT_DIR, 'detailed_outline.md')
VIDEO_CUT_DIR = os.path.join(OUTPUT_DIR, 'videocut')
IMAGE_OUTPUT_DIR = os.path.join(OUTPUT_DIR, 'frames')
```

**æ³¨æ„**ï¼šé…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„ä»…ç”¨äºè·å– `output/` ç›®å½•çš„ä½ç½®ï¼Œå®é™…æ–‡ä»¶åä¼šåœ¨è¿è¡Œæ—¶æ·»åŠ æ—¶é—´æˆ³ã€‚

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [DATA_PROCESSOR_V2_è¯´æ˜.md](./DATA_PROCESSOR_V2_è¯´æ˜.md) - æ•°æ®å¤„ç†å™¨è¯´æ˜
- [FRAMES_ç»“æ„è¯´æ˜.md](./FRAMES_ç»“æ„è¯´æ˜.md) - å¸§æå–è¯¦ç»†è¯´æ˜
- [ASR_PARAFORMER_V2_è¯´æ˜.md](../../ASR_PARAFORMER_V2_è¯´æ˜.md) - ASR å¼•æ“è¯´æ˜

## ğŸ“® æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issueã€‚

