# æ–‡ä»¶ç»“æ„ - ç»Ÿä¸€ç›®å½•è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æ‰€æœ‰ä¸è§†é¢‘å¤„ç†ç›¸å…³çš„è¾“å‡ºæ–‡ä»¶éƒ½ç»„ç»‡åœ¨ä¸€ä¸ªç»Ÿä¸€çš„å¤§æ–‡ä»¶å¤¹ä¸‹ï¼Œå‘½åæ ¼å¼ä¸º `frames_è§†é¢‘å_æ—¶é—´æˆ³`ã€‚è¿™æ ·å¯ä»¥å°†åŒä¸€æ¬¡è¿è¡Œçš„æ‰€æœ‰ç»“æœé›†ä¸­ç®¡ç†ã€‚

## ğŸ• æ—¶é—´æˆ³æ ¼å¼

**ç»Ÿä¸€æ ¼å¼**ï¼š`YYYYMMDD_HHMMSS`

- **ç¤ºä¾‹**ï¼š`20251006_103000`ï¼ˆ2025å¹´10æœˆ6æ—¥ 10:30:00ï¼‰
- **ç‰¹ç‚¹**ï¼š
  - æ˜“äºé˜…è¯»
  - æ–‡ä»¶ç³»ç»Ÿå‹å¥½ï¼ˆæ— ç‰¹æ®Šå­—ç¬¦ï¼‰
  - å¯æ’åºï¼ˆå­—æ¯é¡ºåºå³æ—¶é—´é¡ºåºï¼‰
  - å”¯ä¸€æ€§ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰

## ğŸ“ æ–°çš„æ–‡ä»¶ç»“æ„

### å•æ¬¡è¿è¡Œçš„å®Œæ•´ç»“æ„

å‡è®¾è§†é¢‘æ–‡ä»¶åä¸º `minvideo.mp4`ï¼Œè¿è¡Œæ—¶é—´æˆ³ä¸º `20251006_103000`ï¼š

```
output/
â””â”€â”€ frames_minvideo_20251006_103000/          # å¤§æ–‡ä»¶å¤¹ï¼ˆåŒ…å«æ‰€æœ‰è¾“å‡ºï¼‰
    â”œâ”€â”€ outline.md                             # åˆå§‹å¤§çº²
    â”œâ”€â”€ detailed_outline.md                    # è¯¦ç»†å¤§çº²ï¼ˆå«åŒ¹é…æ–‡æœ¬ï¼‰
    â”‚
    â”œâ”€â”€ videocut/                              # è§†é¢‘åˆ‡ç‰‡å­ç›®å½•
    â”‚   â”œâ”€â”€ 01_é¡¹ç›®æ¶æ„å›¾.mp4
    â”‚   â”œâ”€â”€ 02_å¾®è°ƒæ¨¡å—ä¸Promptä¼˜åŒ–æ¨¡å—.mp4
    â”‚   â”œâ”€â”€ 03_çŸ¥è¯†åº“é—®ç­”æµç¨‹.mp4
    â”‚   â””â”€â”€ ...
    â”‚
    â”œâ”€â”€ frames_01_é¡¹ç›®æ¶æ„å›¾/                 # è§†é¢‘1çš„å¸§æ–‡ä»¶å¤¹
    â”‚   â”œâ”€â”€ frame_0001.jpg
    â”‚   â”œâ”€â”€ frame_0002.jpg
    â”‚   â””â”€â”€ ...
    â”‚
    â”œâ”€â”€ frames_02_å¾®è°ƒæ¨¡å—ä¸Promptä¼˜åŒ–æ¨¡å—/   # è§†é¢‘2çš„å¸§æ–‡ä»¶å¤¹
    â”‚   â”œâ”€â”€ frame_0001.jpg
    â”‚   â”œâ”€â”€ frame_0002.jpg
    â”‚   â””â”€â”€ ...
    â”‚
    â””â”€â”€ frames_03_çŸ¥è¯†åº“é—®ç­”æµç¨‹/              # è§†é¢‘3çš„å¸§æ–‡ä»¶å¤¹
        â”œâ”€â”€ frame_0001.jpg
        â”œâ”€â”€ frame_0002.jpg
        â””â”€â”€ ...
```

## ğŸ†š æ–°æ—§ç»“æ„å¯¹æ¯”

### æ—§ç»“æ„ï¼ˆåˆ†æ•£å­˜å‚¨ï¼‰

```
output/
â”œâ”€â”€ outline_20251006_103000.md
â”œâ”€â”€ detailed_outline_20251006_103000.md
â”œâ”€â”€ videocut_20251006_103000/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ frames_01_é¡¹ç›®æ¶æ„å›¾_20251006_103000/
â”‚   â””â”€â”€ ...
â””â”€â”€ frames_02_å¾®è°ƒæ¨¡å—_20251006_103000/
    â””â”€â”€ ...
```

**é—®é¢˜**ï¼š
- âŒ æ–‡ä»¶åˆ†æ•£åœ¨ output æ ¹ç›®å½•
- âŒ éœ€è¦é€šè¿‡æ—¶é—´æˆ³åŒ¹é…ç›¸å…³æ–‡ä»¶
- âŒ éš¾ä»¥ä¸€æ¬¡æ€§æ‰“åŒ…æˆ–æ¸…ç†

### æ–°ç»“æ„ï¼ˆé›†ä¸­å­˜å‚¨ï¼‰

```
output/
â””â”€â”€ frames_minvideo_20251006_103000/
    â”œâ”€â”€ outline.md
    â”œâ”€â”€ detailed_outline.md
    â”œâ”€â”€ videocut/
    â””â”€â”€ frames_XX/
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ‰€æœ‰ç›¸å…³æ–‡ä»¶é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹
- âœ… æ–‡ä»¶å¤¹ååŒ…å«è§†é¢‘åå’Œæ—¶é—´æˆ³
- âœ… æ˜“äºæ‰“åŒ…ã€å¤‡ä»½ã€æ¸…ç†
- âœ… æ–‡ä»¶åç®€æ´ï¼ˆä¸å†éœ€è¦æ—¶é—´æˆ³ï¼‰

## ğŸ“Š æ–‡ä»¶å‘½åè§„åˆ™è¯¦è§£

### 1. å¤§æ–‡ä»¶å¤¹å‘½å

**æ ¼å¼**ï¼š`frames_è§†é¢‘å_æ—¶é—´æˆ³`

| ç»„æˆéƒ¨åˆ† | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|
| `frames_` | å›ºå®šå‰ç¼€ï¼Œæ ‡è¯†è¿™æ˜¯å¸§å¤„ç†è¾“å‡º | `frames_` |
| è§†é¢‘å | è¾“å…¥è§†é¢‘æ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰ | `minvideo` |
| `_` | åˆ†éš”ç¬¦ | `_` |
| æ—¶é—´æˆ³ | è¿è¡Œæ—¶é—´ï¼ˆYYYYMMDD_HHMMSSï¼‰ | `20251006_103000` |

**å®Œæ•´ç¤ºä¾‹**ï¼š`frames_minvideo_20251006_103000`

### 2. å¤§çº²æ–‡ä»¶å‘½å

| æ–‡ä»¶ | å‘½å | ä½ç½® |
|------|------|------|
| åˆå§‹å¤§çº² | `outline.md` | å¤§æ–‡ä»¶å¤¹æ ¹ç›®å½• |
| è¯¦ç»†å¤§çº² | `detailed_outline.md` | å¤§æ–‡ä»¶å¤¹æ ¹ç›®å½• |

### 3. è§†é¢‘åˆ‡ç‰‡å‘½å

**ç›®å½•**ï¼š`videocut/`ï¼ˆä½äºå¤§æ–‡ä»¶å¤¹ä¸‹ï¼‰

**æ–‡ä»¶å‘½å**ï¼š`åºå·_æ ‡é¢˜.mp4`

| ç¤ºä¾‹ | è¯´æ˜ |
|------|------|
| `01_é¡¹ç›®æ¶æ„å›¾.mp4` | ç¬¬1ä¸ªè§†é¢‘ç‰‡æ®µ |
| `02_å¾®è°ƒæ¨¡å—ä¸Promptä¼˜åŒ–æ¨¡å—.mp4` | ç¬¬2ä¸ªè§†é¢‘ç‰‡æ®µ |
| `03_çŸ¥è¯†åº“é—®ç­”æµç¨‹.mp4` | ç¬¬3ä¸ªè§†é¢‘ç‰‡æ®µ |

### 4. å¸§æ–‡ä»¶å¤¹å‘½å

**æ ¼å¼**ï¼š`frames_è§†é¢‘ç‰‡æ®µå/`ï¼ˆä½äºå¤§æ–‡ä»¶å¤¹ä¸‹ï¼‰

| ç¤ºä¾‹ | è¯´æ˜ |
|------|------|
| `frames_01_é¡¹ç›®æ¶æ„å›¾/` | è§†é¢‘1çš„æ‰€æœ‰å¸§ |
| `frames_02_å¾®è°ƒæ¨¡å—ä¸Promptä¼˜åŒ–æ¨¡å—/` | è§†é¢‘2çš„æ‰€æœ‰å¸§ |

**å¸§æ–‡ä»¶å‘½å**ï¼š`frame_åºå·.jpg`ï¼ˆ4ä½æ•°å­—ï¼Œå¦‚ `frame_0001.jpg`ï¼‰

## ğŸ”§ ä»£ç å®ç°é€»è¾‘

### ä¸»æµç¨‹ï¼ˆmain.pyï¼‰

```python
def main():
    # 1. ç”Ÿæˆæ—¶é—´æˆ³
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    
    # 2. æå–è§†é¢‘å
    video_name = os.path.splitext(os.path.basename(config.INPUT_VIDEO_PATH))[0]
    
    # 3. åˆ›å»ºå¤§æ–‡ä»¶å¤¹
    main_output_folder = f"frames_{video_name}_{timestamp}"
    main_output_path = os.path.join(config.OUTPUT_DIR, main_output_folder)
    os.makedirs(main_output_path, exist_ok=True)
    
    # 4. æ‰€æœ‰åç»­æ“ä½œéƒ½ä½¿ç”¨ main_output_path
    outline_handler.save_outline(outline, output_dir=main_output_path)
    video_handler.cut_videos_by_headings(..., output_dir=main_output_path)
    video_handler.extract_frames_from_videos(..., output_dir=main_output_path)
```

### å¤§çº²ä¿å­˜ï¼ˆoutline_handler.pyï¼‰

```python
def save_outline(outline, output_dir=None):
    """ä¿å­˜å¤§çº²åˆ°æŒ‡å®šç›®å½•"""
    outline_path = os.path.join(output_dir, "outline.md")
    # ä¿å­˜æ–‡ä»¶...
```

### è§†é¢‘åˆ‡ç‰‡ï¼ˆvideo_handler.pyï¼‰

```python
def cut_videos_by_headings(headings, matched_data, output_dir=None):
    """åœ¨æŒ‡å®šç›®å½•ä¸‹åˆ›å»º videocut å­ç›®å½•"""
    videocut_path = os.path.join(output_dir, "videocut")
    os.makedirs(videocut_path, exist_ok=True)
    # åˆ‡åˆ†è§†é¢‘...
```

### å¸§æå–ï¼ˆvideo_handler.pyï¼‰

```python
def extract_frames_from_videos(videocut_path, output_dir=None):
    """åœ¨æŒ‡å®šç›®å½•ä¸‹åˆ›å»º frames_XX å­ç›®å½•"""
    for video_file in video_files:
        video_name = os.path.splitext(video_file)[0]
        frame_folder = f"frames_{video_name}"
        frame_output_dir = os.path.join(output_dir, frame_folder)
        # æå–å¸§...
```

## ğŸ¯ è®¾è®¡ä¼˜åŠ¿

### 1. **é›†ä¸­ç®¡ç†**
- âœ… æ‰€æœ‰ç›¸å…³æ–‡ä»¶åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹å†…
- âœ… ä¾¿äºæ•´ä½“æ‰“åŒ…ã€å¤‡ä»½ã€åˆ†äº«
- âœ… æ¸…ç†æ—¶åªéœ€åˆ é™¤ä¸€ä¸ªæ–‡ä»¶å¤¹

### 2. **æ¸…æ™°çš„å±‚æ¬¡ç»“æ„**
```
å¤§æ–‡ä»¶å¤¹ï¼ˆè¿è¡Œçº§åˆ«ï¼‰
â”œâ”€â”€ æ–‡æ¡£ï¼ˆå¤§çº²ï¼‰
â”œâ”€â”€ è§†é¢‘å­ç›®å½•ï¼ˆvideocut/ï¼‰
â””â”€â”€ å¸§å­ç›®å½•ï¼ˆframes_XX/ï¼‰
```

### 3. **æ–‡ä»¶åç®€æ´**
- âœ… æ–‡ä»¶å¤¹ååŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯ï¼ˆè§†é¢‘å+æ—¶é—´æˆ³ï¼‰
- âœ… å†…éƒ¨æ–‡ä»¶åç®€çŸ­æ˜äº†
- âœ… ä¸éœ€è¦åœ¨æ¯ä¸ªæ–‡ä»¶åä¸­é‡å¤æ—¶é—´æˆ³

### 4. **æ˜“äºæŸ¥æ‰¾**
- âœ… æŒ‰æ–‡ä»¶å¤¹åæ’åºå³æŒ‰å¤„ç†æ—¶é—´æ’åº
- âœ… æ–‡ä»¶å¤¹ååŒ…å«è§†é¢‘åï¼Œä¾¿äºè¯†åˆ«
- âœ… æœ€æ–°çš„ç»“æœæ€»åœ¨æœ€å

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### æŸ¥æ‰¾æœ€æ–°çš„å¤„ç†ç»“æœ

```python
from pathlib import Path

def find_latest_output(video_name=None):
    """
    æŸ¥æ‰¾æœ€æ–°çš„è¾“å‡ºæ–‡ä»¶å¤¹
    
    Args:
        video_name: è§†é¢‘åï¼ˆå¯é€‰ï¼‰ã€‚å¦‚æœæä¾›ï¼ŒåªæŸ¥æ‰¾è¯¥è§†é¢‘çš„ç»“æœ
    """
    output_dir = Path("output")
    
    if video_name:
        pattern = f"frames_{video_name}_*"
    else:
        pattern = "frames_*"
    
    folders = sorted(output_dir.glob(pattern))
    
    if folders:
        latest = folders[-1]  # æŒ‰å­—æ¯é¡ºåºï¼ˆå³æ—¶é—´é¡ºåºï¼‰çš„æœ€åä¸€ä¸ª
        return latest
    
    return None

# ä½¿ç”¨ç¤ºä¾‹
latest = find_latest_output("minvideo")
if latest:
    print(f"æœ€æ–°è¾“å‡º: {latest}")
    print(f"å¤§çº²æ–‡ä»¶: {latest / 'outline.md'}")
    print(f"è§†é¢‘åˆ‡ç‰‡: {latest / 'videocut'}")
```

### è·å–æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰è§†é¢‘ç‰‡æ®µ

```python
def get_video_clips(output_folder):
    """è·å–è¾“å‡ºæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰è§†é¢‘ç‰‡æ®µ"""
    videocut_dir = Path(output_folder) / "videocut"
    
    if videocut_dir.exists():
        video_files = sorted(videocut_dir.glob("*.mp4"))
        return video_files
    
    return []

# ä½¿ç”¨ç¤ºä¾‹
latest = find_latest_output("minvideo")
if latest:
    clips = get_video_clips(latest)
    for clip in clips:
        print(f"è§†é¢‘ç‰‡æ®µ: {clip.name}")
```

### æ‰¹é‡å¤„ç†å¤šä¸ªè§†é¢‘

```python
import config

# å¤„ç†è§†é¢‘1
config.INPUT_VIDEO_PATH = "input_video/video1.mp4"
# è¿è¡Œ main.py
# è¾“å‡ºï¼šoutput/frames_video1_20251006_103000/

# å¤„ç†è§†é¢‘2
config.INPUT_VIDEO_PATH = "input_video/video2.mp4"
# è¿è¡Œ main.py
# è¾“å‡ºï¼šoutput/frames_video2_20251006_103530/

# ç»“æœï¼šæ¯ä¸ªè§†é¢‘çš„æ‰€æœ‰è¾“å‡ºéƒ½ç‹¬ç«‹å­˜å‚¨
```

### æ‰“åŒ…åˆ†äº«ç»“æœ

```python
import shutil

def package_results(output_folder, target_zip):
    """å°†è¾“å‡ºæ–‡ä»¶å¤¹æ‰“åŒ…ä¸º ZIP"""
    folder_path = Path(output_folder)
    
    if folder_path.exists():
        # åˆ›å»º ZIP æ–‡ä»¶ï¼ˆä¸å«æ‰©å±•åï¼‰
        shutil.make_archive(
            str(Path(target_zip).with_suffix('')),
            'zip',
            folder_path.parent,
            folder_path.name
        )
        print(f"å·²æ‰“åŒ…åˆ°: {target_zip}")

# ä½¿ç”¨ç¤ºä¾‹
latest = find_latest_output("minvideo")
if latest:
    package_results(latest, "minvideo_results.zip")
```

### æ¸…ç†æ—§ç»“æœï¼ˆä¿ç•™æœ€è¿‘Nä¸ªï¼‰

```python
def cleanup_old_results(keep_latest=3, video_name=None):
    """
    åˆ é™¤æ—§çš„è¾“å‡ºæ–‡ä»¶å¤¹ï¼Œåªä¿ç•™æœ€æ–°çš„Nä¸ª
    
    Args:
        keep_latest: ä¿ç•™æœ€è¿‘å¤šå°‘ä¸ªç»“æœ
        video_name: è§†é¢‘åï¼ˆå¯é€‰ï¼‰
    """
    output_dir = Path("output")
    
    if video_name:
        pattern = f"frames_{video_name}_*"
    else:
        pattern = "frames_*"
    
    folders = sorted(output_dir.glob(pattern))
    
    # åˆ é™¤é™¤äº†æœ€æ–°Nä¸ªä¹‹å¤–çš„æ‰€æœ‰æ–‡ä»¶å¤¹
    for folder in folders[:-keep_latest]:
        print(f"åˆ é™¤æ—§è¾“å‡º: {folder}")
        shutil.rmtree(folder)

# ä½¿ç”¨ç¤ºä¾‹
cleanup_old_results(keep_latest=3, video_name="minvideo")
```

## ğŸ“ æ—¥å¿—è¾“å‡ºç¤ºä¾‹

è¿è¡Œ `main.py` æ—¶çš„æ—¥å¿—ï¼š

```
============================================================
å¼€å§‹å¤„ç†æµç¨‹ - æ—¶é—´æˆ³: 20251006_103000
è§†é¢‘æ–‡ä»¶: minvideo
è¾“å‡ºç›®å½•: output/frames_minvideo_20251006_103000
============================================================

--- æ­¥éª¤ 1: å¼€å§‹å¤„ç†ASRæ•°æ® ---
æ£€æµ‹åˆ°æ–°æ ¼å¼ï¼ˆParaformer V2ï¼‰ï¼Œå…± 89 ä¸ªå¥å­
--- ASRæ•°æ®å¤„ç†å®Œæˆ ---

--- æ­¥éª¤ 2: å¼€å§‹ç”ŸæˆLLMå¤§çº² ---
--- LLMå¤§çº²ç”Ÿæˆå®Œæˆ ---

--- æ­¥éª¤ 3: æ­£åœ¨å°†å¤§çº²ä¿å­˜åˆ° output/frames_minvideo_20251006_103000/outline.md ---
--- å¤§çº²ä¿å­˜æˆåŠŸ ---

--- æ­¥éª¤ 5: æ­£åœ¨ç”Ÿæˆè¯¦ç»†å¤§çº²æ–‡ä»¶åˆ° output/frames_minvideo_20251006_103000/detailed_outline.md ---
--- è¯¦ç»†å¤§çº²ç”ŸæˆæˆåŠŸ ---

--- æ­¥éª¤ 6: å¼€å§‹æ ¹æ®å¤§çº²åˆ‡åˆ†è§†é¢‘ ---
è§†é¢‘ç‰‡æ®µå°†ä¿å­˜åˆ°: output/frames_minvideo_20251006_103000/videocut
--- è§†é¢‘åˆ‡åˆ†å®Œæˆï¼Œå…±ç”Ÿæˆ 3 ä¸ªè§†é¢‘ç‰‡æ®µ ---

--- æ­¥éª¤ 7: å¼€å§‹ä»è§†é¢‘ç‰‡æ®µä¸­æå–å¸§ ---
ä»ç›®å½•è¯»å–è§†é¢‘æ–‡ä»¶: output/frames_minvideo_20251006_103000/videocut
æ‰¾åˆ° 3 ä¸ªè§†é¢‘æ–‡ä»¶
æ­£åœ¨ä» '01_é¡¹ç›®æ¶æ„å›¾.mp4' æå–å¸§åˆ° 'output/frames_minvideo_20251006_103000/frames_01_é¡¹ç›®æ¶æ„å›¾'...
æˆåŠŸä» '01_é¡¹ç›®æ¶æ„å›¾.mp4' æå–äº† 120 å¸§ã€‚
--- å¸§æå–å®Œæˆï¼Œæ€»å…±æå–äº† 350 å¸§ ---

============================================================
å¤„ç†æµç¨‹å®Œæˆ - æ—¶é—´æˆ³: 20251006_103000
============================================================
```

## ğŸ” é…ç½®è¯´æ˜

åœ¨ `config.py` ä¸­ä¿®æ”¹è¾“å…¥è§†é¢‘ï¼š

```python
# å½“å‰é…ç½®
INPUT_VIDEO_PATH = os.path.join(PROJECT_ROOT, 'input_video', 'minvideo.mp4')

# å¤„ç†ä¸åŒè§†é¢‘åªéœ€ä¿®æ”¹è¿™ä¸€è¡Œ
INPUT_VIDEO_PATH = os.path.join(PROJECT_ROOT, 'input_video', 'ä½ çš„è§†é¢‘.mp4')
```

è¾“å‡ºå°†è‡ªåŠ¨ç”Ÿæˆåˆ°ï¼š`output/frames_ä½ çš„è§†é¢‘_æ—¶é—´æˆ³/`

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [CONFIG_é…ç½®è¯´æ˜.md](./CONFIG_é…ç½®è¯´æ˜.md) - é…ç½®æ–‡ä»¶è¯´æ˜
- [DATA_PROCESSOR_V2_è¯´æ˜.md](./DATA_PROCESSOR_V2_è¯´æ˜.md) - æ•°æ®å¤„ç†è¯´æ˜
- [ASR_PARAFORMER_V2_è¯´æ˜.md](../../ASR_PARAFORMER_V2_è¯´æ˜.md) - ASR å¼•æ“è¯´æ˜

## ğŸ“® æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issueã€‚

